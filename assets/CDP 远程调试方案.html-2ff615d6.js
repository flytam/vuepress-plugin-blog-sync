import{_ as t,z as e,A as c,Y as n,C as s,U as o,a6 as p,Q as r}from"./framework-cb9358d9.js";const l={},u=n("p",null,[n("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4eb6a01e6564840817b127265b07edd~tplv-k3u1fbpfcp-zoom-1.image",alt:""})],-1),i=n("img",{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c7ed7d2e1c8c482c9eddbb14eb62a5b7~tplv-k3u1fbpfcp-watermark.image?",alt:"螺旋.png"},null,-1),k={href:"https://www.zoo.team/article/cdp",target:"_blank",rel:"noopener noreferrer"},d=n("h1",{id:"什么是-cdp-协议",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#什么是-cdp-协议","aria-hidden":"true"},"#"),s(" 什么是 cdp 协议")],-1),m=n("p",null,"cdp 协议简称 chrome 调试协议，是基于 scoket（websocket、usb、adb ）消息的 json rpc 协议。用来调用 chrome 内部的方法实现 js，css ，dom 的开发调试。 可以将 实现了 cdp 协议的应用 看做 rpc 调用的服务端（ chrome ，puppeteer）， 将调试面板看做 rpc 调用的客户端（devtools）。",-1),b=n("h1",{id:"devtools-调试系统",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#devtools-调试系统","aria-hidden":"true"},"#"),s(" devtools 调试系统")],-1),h=n("p",null,"完整的调试系统分别由前端，后端，协议，通道四部分组成",-1),v=n("strong",null,"Frontend",-1),g={href:"https://github.com/ChromeDevTools/devtools-frontend",target:"_blank",rel:"noopener noreferrer"},_=n("li",null,[n("strong",null,"Backend"),s(": 实现了 cdp 协议的应用，会接收 cdp 命令&发送 cdp 事件。Chromium、V8 或 Node.js")],-1),q=n("li",null,[n("strong",null,"Protocol"),s("：cdp 调试协议，调试器前端和后端使用此协议通信。 它分为代表被检查实体的语义方面的域。 每个域定义类型、命令（从前端发送到后端的消息）和事件（从后端发送到前端的消息）。该协议基于 json rpc 2.0 运行；")],-1),f=n("li",null,[n("strong",null,"Channels"),s("：消息通道，后端和前端之间发送协议消息的一种方式。包括：Embedder Channel、WebSocket Channel、Chrome Extensions Channel、USB/ADB Channel。")],-1),w=n("p",null,[n("img",{src:"https://www.zoo.team/images/upload/upload_58a36849307d7231d2e3254c9874a40b.png#crop=0&crop=0&crop=1&crop=1&id=JPO8t&originHeight=628&originWidth=1264&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=",alt:""})],-1),C=n("h1",{id:"chrome-远程调试",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#chrome-远程调试","aria-hidden":"true"},"#"),s(" chrome 远程调试")],-1),y={href:"https://github.com/ChromeDevTools/devtools-frontend",target:"_blank",rel:"noopener noreferrer"},D={href:"https://github.com/ChromeDevTools/devtools-frontend",target:"_blank",rel:"noopener noreferrer"},F=p(`<ul><li>启动 cdp 服务端</li><li>启动 cdp 客户端</li><li>创建链接</li></ul><h2 id="启动-cdp-服务端" tabindex="-1"><a class="header-anchor" href="#启动-cdp-服务端" aria-hidden="true">#</a> 启动 cdp 服务端</h2><p>以 Chrome，puppetter 为例启动 backend 应用，设置调试端口 9222。</p><ul><li>chrome</li></ul><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code> <span class="token operator">/</span>Applications<span class="token operator">/</span>Google\\ Chrome<span class="token punctuation">.</span>app<span class="token operator">/</span>Contents<span class="token operator">/</span>MacOS<span class="token operator">/</span>Google\\ Chrome <span class="token operator">--</span>remote<span class="token operator">-</span>debugging<span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">9222</span> <span class="token operator">--</span>user<span class="token operator">-</span>data<span class="token operator">-</span>dir<span class="token operator">=</span><span class="token punctuation">.</span><span class="token operator">/</span>test
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li>puppetter</li></ul><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>
<span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>puppeteer<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> browser <span class="token operator">=</span> <span class="token keyword">await</span> puppeteer<span class="token punctuation">.</span><span class="token function">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    args<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">--</span>remote<span class="token operator">-</span>debugging<span class="token operator">-</span>port<span class="token operator">=</span><span class="token number">9222</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">--</span>remote<span class="token operator">-</span>debugging<span class="token operator">-</span>address<span class="token operator">=</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span><span class="token function">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">// let res= await page.goto(&amp;#39;https://www.baidu.com&amp;#39;);</span>

  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span><span class="token function">wsEndpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// output -&amp;gt; ws://127.0.0.1:57724/devtools/browser/705082a5-19e6-4e9a-b8a6-477b7b6e1bd6</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,7),x={href:"http://0.0.0.0:9222/json",target:"_blank",rel:"noopener noreferrer"},j=p(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token punctuation">[</span> <span class="token punctuation">{</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>description<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>devtoolsFrontendUrl<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">/</span>devtools<span class="token operator">/</span>inspector<span class="token punctuation">.</span>html<span class="token operator">?</span>ws<span class="token operator">=</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">9222</span><span class="token operator">/</span>devtools<span class="token operator">/</span>page<span class="token operator">/</span>659E9C174913FC5670B5F6E78B6B91FD<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>id<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>659E9C174913FC5670B5F6E78B6B91FD<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>title<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>欢迎使用 Chrome<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>type<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>page<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>url<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>chrome<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>welcome<span class="token operator">/</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>webSocketDebuggerUrl<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>ws<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">9222</span><span class="token operator">/</span>devtools<span class="token operator">/</span>page<span class="token operator">/</span>659E9C174913FC5670B5F6E78B6B91FD<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>description<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>devtoolsFrontendUrl<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">/</span>devtools<span class="token operator">/</span>inspector<span class="token punctuation">.</span>html<span class="token operator">?</span>ws<span class="token operator">=</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">9222</span><span class="token operator">/</span>devtools<span class="token operator">/</span>page<span class="token operator">/</span>9902C5D5F55923DFC457B7AA423F957E<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>faviconUrl<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>cn<span class="token punctuation">.</span>bing<span class="token punctuation">.</span>com<span class="token operator">/</span>sa<span class="token operator">/</span>simg<span class="token operator">/</span>favicon<span class="token operator">-</span>2x<span class="token punctuation">.</span>ico<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>id<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>9902C5D5F55923DFC457B7AA423F957E<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>title<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>必应<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>type<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>page<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>url<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>cn<span class="token punctuation">.</span>bing<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>webSocketDebuggerUrl<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>ws<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">9222</span><span class="token operator">/</span>devtools<span class="token operator">/</span>page<span class="token operator">/</span>9902C5D5F55923DFC457B7AA423F957E<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>description<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>devtoolsFrontendUrl<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">/</span>devtools<span class="token operator">/</span>inspector<span class="token punctuation">.</span>html<span class="token operator">?</span>ws<span class="token operator">=</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">9222</span><span class="token operator">/</span>devtools<span class="token operator">/</span>page<span class="token operator">/</span>428C9AC3F9B6AF7235CC41D849DD7589<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>faviconUrl<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token operator">/</span>favicon<span class="token punctuation">.</span>ico<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>id<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>428C9AC3F9B6AF7235CC41D849DD7589<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>title<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>百度一下，你就知道<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>type<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>page<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>url<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>baidu<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
   <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>webSocketDebuggerUrl<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>ws<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token operator">:</span><span class="token number">9222</span><span class="token operator">/</span>devtools<span class="token operator">/</span>page<span class="token operator">/</span>428C9AC3F9B6AF7235CC41D849DD7589<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
<span class="token punctuation">}</span> <span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="启动-cdp-客户端" tabindex="-1"><a class="header-anchor" href="#启动-cdp-客户端" aria-hidden="true">#</a> 启动 cdp 客户端</h2>`,2),A={href:"https://github.com/ChromeDevTools/devtools-frontend",target:"_blank",rel:"noopener noreferrer"},B={href:"https://github.com/ChromeDevTools/devtools-frontend",target:"_blank",rel:"noopener noreferrer"},T={href:"http://0.0.0.0:9222/devtools/inspector.html",target:"_blank",rel:"noopener noreferrer"},E=n("p",null,[n("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5c16ef1d8210444580e4e20fea94b03a~tplv-k3u1fbpfcp-zoom-1.image",alt:""})],-1),S=n("h2",{id:"创建链接",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#创建链接","aria-hidden":"true"},"#"),s(" 创建链接")],-1),P={href:"http://0.0.0.0:9222/devtools/inspector.html?ws=0.0.0.0:9222/devtools/page/9902C5D5F55923DFC457B7AA423F957E",target:"_blank",rel:"noopener noreferrer"},z={href:"http://0.0.0.0:9222/devtools/inspector.html?ws=0.0.0.0:9222/devtools/page/9902C5D5F55923DFC457B7AA423F957E",target:"_blank",rel:"noopener noreferrer"},U={href:"http://0.0.0.0:9222/devtools/inspector.html?ws=0.0.0.0:9222/devtools/page/9902C5D5F55923DFC457B7AA423F957E",target:"_blank",rel:"noopener noreferrer"},I={href:"https://github.com/ChromeDevTools/devtools-frontend",target:"_blank",rel:"noopener noreferrer"},H=n("p",null,[n("img",{src:"https://www.zoo.team/images/upload/upload_416eea9c9510de5ddbfc602a7729ee18.png#crop=0&crop=0&crop=1&crop=1&id=A1gI3&originHeight=639&originWidth=1518&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=",alt:""})],-1),R=n("p",null,[n("img",{src:"https://www.zoo.team/images/upload/upload_e57c73cb1b3c7c3f7694a192fba016a3.png#crop=0&crop=0&crop=1&crop=1&id=C6ZEN&originHeight=2628&originWidth=5402&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=",alt:""})],-1),L={href:"https://github.com/ChromeDevTools/devtools-frontend",target:"_blank",rel:"noopener noreferrer"},M=p(`<h1 id="cdp协议结构" tabindex="-1"><a class="header-anchor" href="#cdp协议结构" aria-hidden="true">#</a> cdp协议结构</h1><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>cdp 协议按域「Domain」划分能力，每个域下有 Method、Event 和 Types。（<span class="token punctuation">[</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>chromedevtools<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token operator">/</span>devtools<span class="token operator">-</span>protocol<span class="token operator">/</span>tot<span class="token operator">/</span>Debugger<span class="token operator">/</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>chromedevtools<span class="token punctuation">.</span>github<span class="token punctuation">.</span>io<span class="token operator">/</span>devtools<span class="token operator">-</span>protocol<span class="token operator">/</span>tot<span class="token operator">/</span>Debugger<span class="token operator">/</span><span class="token punctuation">)</span> ）
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Method 对应 socket 通信的请求/响应模式，Events 对应 socket 通信的发布/订阅模式，Types 为交互中使用到的实体。<br><img src="https://www.zoo.team/images/upload/upload_5b8b07f409c50152678427819026e4e1.png#crop=0&amp;crop=0&amp;crop=1&amp;crop=1&amp;id=If5HM&amp;originHeight=1292&amp;originWidth=2814&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;status=done&amp;style=none&amp;title=" alt=""></p>`,3),N={href:"https://github.com/ChromeDevTools/devtools-frontend",target:"_blank",rel:"noopener noreferrer"},W=p(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function-variable function">pp</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">244</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">pp</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token punctuation">{</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>id<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token number">47</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>method<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>Runtime<span class="token punctuation">.</span>evaluate<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>params<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>expression<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token function-variable function">pp</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">244</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>includeCommandLineAPI<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>generatePreview<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>userGesture<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>awaitPromise<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>throwOnSideEffect<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>timeout<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token number">500</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>disableBreaks<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>replMode<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>uniqueContextId<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">-</span><span class="token number">3083772769491583108.6833303176535544523</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token punctuation">{</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>id<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token number">178</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>method<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>Runtime<span class="token punctuation">.</span>compileScript<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>params<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>expression<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token function-variable function">pp</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token number">244</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>sourceURL<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>persistScript<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>executionContextId<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token number">7</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token punctuation">{</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>id<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>method<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>Runtime<span class="token punctuation">.</span>compileScript<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>params<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>expression<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token function">pp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>sourceURL<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>persistScript<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>executionContextId<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token number">7</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="手动实现" tabindex="-1"><a class="header-anchor" href="#手动实现" aria-hidden="true">#</a> 手动实现</h1><h3 id="h5-端通过-cdp-协议调用调试" tabindex="-1"><a class="header-anchor" href="#h5-端通过-cdp-协议调用调试" aria-hidden="true">#</a> H5 端通过 CDP 协议调用调试</h3><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>ws<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token operator">:</span><span class="token number">9222</span><span class="token operator">/</span>devtools<span class="token operator">/</span>page<span class="token operator">/</span>620F91C22D41B614947001C52AC55E53<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token function-variable function">ppp</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
<span class="token comment">// 调用 Command</span>

  <span class="token keyword">debugger</span>
  ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 获取数据：{&amp;quot;method&amp;quot;: &amp;quot;Page.loadEventFired&amp;quot;, &amp;quot;params&amp;quot;: {&amp;quot;timestamp&amp;quot;: 1402317772.874949}}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">{</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>id<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>method<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>Page<span class="token punctuation">.</span>navigate<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>params<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>url<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>github<span class="token punctuation">.</span>com<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="远程调试" tabindex="-1"><a class="header-anchor" href="#远程调试" aria-hidden="true">#</a> 远程调试</h2>`,8),O={href:"https://github.com/auchenberg/devtools-remote",target:"_blank",rel:"noopener noreferrer"},V={href:"https://github.com/auchenberg/devtools-remote",target:"_blank",rel:"noopener noreferrer"},G={href:"https://developer.chrome.com/docs/extensions/reference/debugger/#type-Debuggee",target:"_blank",rel:"noopener noreferrer"},Z=n("strong",null,[s("Chrome Extensions Api（"),n("strong",null,"chrome.debugger"),s("）")],-1),J=p("<ul><li><strong>chrome.debugger.getTargets</strong>： 获取可调试目标的列表( tab_id )</li><li><strong>chrome.debugger.attach</strong>: 将调试器附加到指定目标。</li><li><strong>chrome.debugger.sendCommand:</strong> 将 cdp 命令发送至调试目标。</li><li><strong>chrome.debugger.onEvent.addListene</strong>： 监听指定选项卡页中的所有事件，在回调函数 response cdp 消息到 scocket 服务端。</li></ul><p><strong>插件内部逻辑实现</strong></p>",2),Q=n("li",null,"点击插件（chrome.browserAction.onClicked.addListener）获取当前页 tabID ，即目标 id.",-1),X=n("li",null,"调用 chrome.debugger.attach，将调试器附加到指定目标。",-1),Y={href:"https://github.com/ChromeDevTools/devtools-frontend",target:"_blank",rel:"noopener noreferrer"},$=n("li",null,"插件连接成功： 监听从代理服务器推送的 data.request 类型消息。 调用 chrome.debugger.sendCommand 执行 cdp 协议的命令, 将执行结果返回给socket服务端消息事件名为 data.response 消息 id 保持一致）。",-1),K=n("li",null,"调用 chrome.debugger.onEvent.addListener，监听调试页的所有事件，转成 cdp 的消息结构 {method: method, params: params} ,发送消息事件名为 data.event 到代理服务器，最终转发到调试应用",-1),nn=n("p",null,[n("strong",null,"socket_proxy 逻辑"),s(" 代理服务器的逻辑很简单，将来自插件端 'data.response' , 'data.event' 的事件消息转发到调试应用上。 将来自调试应用 'data.request' 事件消息转发到 backend 插件端。")],-1),sn=n("p",null,[n("img",{src:"https://www.zoo.team/images/upload/upload_dcbb6ad4e891027ffebc1e1ee2f9ba26.png#crop=0&crop=0&crop=1&crop=1&id=BfUIi&originHeight=522&originWidth=1194&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=",alt:""}),n("img",{src:"https://www.zoo.team/images/upload/upload_b288851b62b2b63174ec679145d9e539.png#crop=0&crop=0&crop=1&crop=1&id=XHNvy&originHeight=2628&originWidth=5402&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=",alt:""})],-1),an={href:"https://github.com/wanwu/devtools-pro.git",target:"_blank",rel:"noopener noreferrer"},on=n("p",null,"同理 react-devtools 的实现方案，也与cdp方案 类似， 在调试页面中引入 或者 通过插件插入 backend.js，监听变化发送到调试应用。",-1),pn={href:"https://juejin.cn/post/7044678301926817806",target:"_blank",rel:"noopener noreferrer"},tn=n("p",null,"参考文档",-1),en={href:"https://chromedevtools.github.io/devtools-protocol/tot/Debugger/",target:"_blank",rel:"noopener noreferrer"},cn={href:"https://github.com/cyrus-and/chrome-remote-interface",target:"_blank",rel:"noopener noreferrer"},rn={href:"https://zhaomenghuan.js.org/blog/chrome-devtools.html",target:"_blank",rel:"noopener noreferrer"},ln=n("h2",{id:"推荐阅读",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#推荐阅读","aria-hidden":"true"},"#"),s(" 推荐阅读")],-1),un={href:"https://juejin.cn/post/7085873582588297224",target:"_blank",rel:"noopener noreferrer"},kn={href:"https://juejin.cn/post/7078078998357475358",target:"_blank",rel:"noopener noreferrer"},dn=n("p",null,'[浅析 Snabbdom 中 vnode 和 diff 算法](https://juejin.cn/post/7067693810918096903 "浅析 Snabbdom 中 vnode 和 diff 算法")',-1),mn=n("p",null,'[如何利用 SCSS 实现一键换肤](https://juejin.cn/post/7062496975454732301 "如何利用 SCSS 实现一键换肤")',-1),bn=n("h2",{id:"开源作品",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#开源作品","aria-hidden":"true"},"#"),s(" 开源作品")],-1),hn=n("ul",null,[n("li",null,"政采云前端小报")],-1),vn={href:"https://www.zoo.team/openweekly/",target:"_blank",rel:"noopener noreferrer"},gn=n("ul",null,[n("li",null,"商品选择 sku 插件")],-1),_n={href:"https://github.com/zcy-inc/skuPathFinder-back",target:"_blank",rel:"noopener noreferrer"},qn=n("h2",{id:"招贤纳士",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#招贤纳士","aria-hidden":"true"},"#"),s(" 招贤纳士")],-1),fn=n("p",null,"政采云前端团队（ZooTeam），一个年轻富有激情和创造力的前端团队，隶属于政采云产品研发部，Base 在风景如画的杭州。团队现有 60 余个前端小伙伴，平均年龄 27 岁，近 4 成是全栈工程师，妥妥的青年风暴团。成员构成既有来自于阿里、网易的“老”兵，也有浙大、中科大、杭电等校的应届新人。团队在日常的业务对接之外，还在物料体系、工程平台、搭建平台、性能体验、云端应用、数据分析及可视化等方向进行技术探索和实战，推动并落地了一系列的内部技术产品，持续探索前端技术体系的新边界。",-1),wn=n("p",null,[s("如果你想改变一直被事折腾，希望开始能折腾事；如果你想改变一直被告诫需要多些想法，却无从破局；如果你想改变你有能力去做成那个结果，却不需要你；如果你想改变你想做成的事需要一个团队去支撑，但没你带人的位置；如果你想改变既定的节奏，将会是“5 年工作时间 3 年工作经验”；如果你想改变本来悟性不错，但总是有那一层窗户纸的模糊… 如果你相信相信的力量，相信平凡人能成就非凡事，相信能遇到更好的自己。如果你希望参与到随着业务腾飞的过程，亲手推动一个有着深入的业务理解、完善的技术体系、技术创造价值、影响力外溢的前端团队的成长历程，我觉得我们该聊聊。任何时间，等着你写点什么，发给 "),n("code",null,"ZooTeam@cai-inc.com")],-1);function Cn(yn,Dn){const a=r("ExternalLinkIcon");return e(),c("div",null,[u,n("p",null,[i,s(" > 这是第 140 篇不掺水的原创，想获取更多原创好文，请搜索公众号关注我们吧~ 本文首发于政采云前端博客："),n("a",k,[s("CDP 远程调试方案"),o(a)])]),d,m,b,h,n("ul",null,[n("li",null,[v,s("：调试器前端，如 "),n("a",g,[s("chrome-devtools-frontend"),o(a)]),s(" 一个 web 应用，接收 cdp 事件&发送 cdp 命令，实现 dom，network，debugger 的执行调试。")]),_,q,f]),w,C,n("p",null,[s("如上，所有能够消费发送 cdp 消息的应用都可以被 "),n("a",y,[s("chrome-devtools-frontend"),o(a)]),s(" 调试。chrome 集成了cdp协议，所以只需要通过消息通道与 "),n("a",D,[s("chrome-devtools-frontend"),o(a)]),s(" 应用 建立 socket 链接就可以被调试端调试。调试启动分为三步：")]),F,n("p",null,[s("此时访问 "),n("a",x,[s("http://0.0.0.0:9222/json"),o(a)]),s(" 此时可以获取调试页面 id 和 页面的 webSocketDebuggerUrl ，代表 backend 端启动成功。")]),j,n("p",null,[n("a",A,[s("chrome-devtools-frontend"),o(a)]),s(" 作为一个纯 web 应用，可以通过 koa 部署访问。同时 chrome 默认也集成了 "),n("a",B,[s("chrome-devtools-frontend"),o(a)]),s(" 服务。在 cdp 服务端启动后可以直接访问 "),n("a",T,[s("http://0.0.0.0:9222/devtools/inspector.html"),o(a)]),s("。")]),E,S,n("p",null,[s("传入 socket_backend_url ，"),n("a",P,[s("http://0.0.0.0:9222/devtools/inspector.html?ws="),o(a)]),s("${webSocketDebuggerUrl}")]),n("p",null,[s("或者直接访问 "),n("a",z,[s("http://0.0.0.0:9222/"),o(a)]),s(" 可以看到浏览器中的的tab线程页，点击需要调试的页面，"),n("a",U,[s("http://0.0.0.0:9222/devtools/inspector.html?ws=0.0.0.0:9222/devtools/page/9902C5D5F55923DFC457B7AA423F957E"),o(a)]),s(" ， 就可以连接 "),n("a",I,[s("chrome-devtools-frontend"),o(a)]),s(" 调试了。")]),H,R,n("p",null,[s("此时打开 network，查看 ws ，可以看到 backend 端在接收 "),n("a",L,[s("chrome-devtools-frontend"),o(a)]),s(" 发送的 cdp 命令，并将 dom，network，资源信息返回给远程调试端")]),M,n("p",null,[s("用远程执行一段 js 为例，在 "),n("a",N,[s("chrome-devtools-frontend"),o(a)]),s(" 控制台输入下面代码，backend 端分别收到执行三个 cdp 命令。 Runtime.compileScript->Runtime.evaluate->Runtime.compileScript")]),W,n("p",null,[s("chrome 社区提供了基础的远程调试方案 ："),n("a",O,[s("devtools-remote"),o(a)]),s(" 。 分别提供 websocket 服务做消息转发 和 chrome 插件在 backend 端来监听执行发送 cdp 消息。")]),n("p",null,[n("a",V,[s("devtools-remote"),o(a)]),s(" 调试插件在 background 层实现 cdp 消息监听, 响应和执行。主要依赖下面几个 api 。 "),n("a",G,[Z,o(a)])]),J,n("ol",null,[Q,X,n("li",null,[s("socket connect 连接代理 websocket 服务器。（代理服务器连接调试应用 "),n("a",Y,[s("chrome-devtools-frontend"),o(a)]),s(" ）")]),$,K]),nn,sn,n("p",null,[s("此外社区还有 chobitsu 这样的 cdp 解析库,提供了 Storage、Runtime、Network、DOM、DOMDebugger、DOMStorage 的能力。与需要依赖在插件 background 层执行 chrome.debugger API 的方案不同。chobitsu 在浏览器运行时环境中手动实现了cdp 协议。 基于chobitsu 的能力可以实现待调试页面通过加载 backend.js 监听浏览器事件 执行 cdp 命令，实现 dom css network 的远程调试。 具体用例可以参考 "),n("a",an,[s("devtools-pro"),o(a)]),s(" 。由此方案进一步联想到xss安全的重要性。")]),on,n("p",null,[s("PS：之前我们有输出过在线调试的方案，链接是"),n("a",pn,[s("前端工程师生产环境 debugger 技巧"),o(a)]),s("，感兴趣的同学可以点开看一下。")]),tn,n("p",null,[s("> "),n("a",en,[s("chrome DevTools Protocol"),o(a)])]),n("p",null,[s("> "),n("a",cn,[s("chrome-remote-interface"),o(a)])]),n("p",null,[s("> "),n("a",rn,[s("深入理解 Chrome DevTools"),o(a)])]),ln,n("p",null,[n("a",un,[s("如何落地一个智能机器人"),o(a)])]),n("p",null,[n("a",kn,[s("一名练习时长 2 年零 8 个月的前端练习生自述"),o(a)])]),dn,mn,bn,hn,n("p",null,[n("strong",null,[s("开源地址 "),n("a",vn,[s("www.zoo.team/openweekly/"),o(a)])]),s(" (小报官网首页有微信交流群)")]),gn,n("p",null,[n("strong",null,[s("开源地址 "),n("a",_n,[s("https://github.com/zcy-inc/skuPathFinder-back/"),o(a)])])]),qn,fn,wn])}const xn=t(l,[["render",Cn],["__file","CDP 远程调试方案.html.vue"]]);export{xn as default};
