import{_ as o,z as e,A as c,Y as n,C as s,U as p,a6 as t,Q as l}from"./framework-cb9358d9.js";const r={},u={href:"https://juejin.cn/post/6978685539985653767",target:"_blank",rel:"noopener noreferrer"},i=n("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4eb6a01e6564840817b127265b07edd~tplv-k3u1fbpfcp-zoom-1.image",alt:""},null,-1),k={href:"https://zoo.team/article/about-vite",target:"_blank",rel:"noopener noreferrer"},d=n("p",null,[n("img",{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d49f2992684343948565c0d9fa97ca7a~tplv-k3u1fbpfcp-watermark.image",alt:"清音.png"})],-1),m=n("h3",{id:"vite-的特性",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#vite-的特性","aria-hidden":"true"},"#"),s(" Vite 的特性")],-1),v={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules?fileGuid=DDr3GGh6QRvQgWQC",target:"_blank",rel:"noopener noreferrer"},b=n("code",null,"import",-1),h=n("code",null,"export",-1),f={href:"https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Guide/Modules?fileGuid=DDr3GGh6QRvQgWQC",target:"_blank",rel:"noopener noreferrer"},g=t(`<p>那这有什么优势呢？</p><h4 id="去掉打包步骤" tabindex="-1"><a class="header-anchor" href="#去掉打包步骤" aria-hidden="true">#</a> 去掉打包步骤</h4><p>打包是开发者利用打包工具将应用各个模块集合在一起形成 bundle，以一定规则读取模块的代码，以便在不支持模块化的浏览器里使用，并且可以减少 http 请求的数量。但其实在本地开发过程中打包反而增加了我们排查问题的难度，增加了响应时长，Vite 在本地开发命令中去除了打包步骤，从而缩短构建时长。</p><h4 id="按需加载" tabindex="-1"><a class="header-anchor" href="#按需加载" aria-hidden="true">#</a> 按需加载</h4><p>为了减少 bundle 大小，一般会想要按需加载，主要有两种方式：</p><ol><li>使用动态引入 <code>import()</code> 的方式异步的加载模块，被引入模块依然需要提前编译打包；</li><li>使用 tree shaking 等方式尽力的去掉未引用的模块；</li></ol><p>而 Vite 的方式更为直接，它只在某个模块被 import 的时候动态的加载它，实现了真正的按需加载，减少了加载文件的体积，缩短了时长；</p><h4 id="vite开发环境主体流程" tabindex="-1"><a class="header-anchor" href="#vite开发环境主体流程" aria-hidden="true">#</a> Vite开发环境主体流程</h4><p>下图是 Vite 在开发环境运行时加载文件的主体流程。</p><p>&lt;img src=&quot;https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6922f9b694324cb193acdbb482babadb~tplv-k3u1fbpfcp-zoom-1.image&quot; style=&quot;zoom:60%;&quot; /&gt;</p><h3 id="vite-部分源码解析" tabindex="-1"><a class="header-anchor" href="#vite-部分源码解析" aria-hidden="true">#</a> Vite 部分源码解析</h3><h4 id="总体目录结构" tabindex="-1"><a class="header-anchor" href="#总体目录结构" aria-hidden="true">#</a> 总体目录结构</h4><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token operator">|</span><span class="token operator">-</span><span class="token constant">CHANGELOG</span><span class="token punctuation">.</span>md
<span class="token operator">|</span><span class="token operator">-</span><span class="token constant">LICENSE</span><span class="token punctuation">.</span>md
<span class="token operator">|</span><span class="token operator">-</span><span class="token constant">README</span><span class="token punctuation">.</span>md
<span class="token operator">|</span><span class="token operator">-</span>bin
<span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>openChrome<span class="token punctuation">.</span>applescript
<span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>vite<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">-</span>client<span class="token punctuation">.</span>d<span class="token punctuation">.</span>ts
<span class="token operator">|</span><span class="token operator">-</span><span class="token keyword">package</span><span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">-</span>rollup<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js #打包配置文件
<span class="token operator">|</span><span class="token operator">-</span>scripts
<span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>patchTypes<span class="token punctuation">.</span>js
<span class="token operator">|</span><span class="token operator">-</span>src
<span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>client #客户端
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>client<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>env<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>overlay<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>tsconfig<span class="token punctuation">.</span>json
<span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>node #服务端
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>build<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>cli<span class="token punctuation">.</span>ts #命令入口文件
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>config<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>constants<span class="token punctuation">.</span>ts #常量
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>importGlob<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>index<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>logger<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>optimizer
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>esbuildDepPlugin<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>index<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>registerMissing<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>scan<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>plugin<span class="token punctuation">.</span>ts #rollup 插件
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>plugins   #插件相关文件
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>asset<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>clientInjections<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>css<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>esbuild<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>html<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>index<span class="token punctuation">.</span>ts 
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">...</span>
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>preview<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>server
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>hmr<span class="token punctuation">.</span>ts #热更新
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>http<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>index<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>middlewares #中间件
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">...</span>
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>moduleGraph<span class="token punctuation">.</span>ts <span class="token function">#模块间关系组装</span><span class="token punctuation">(</span>树形<span class="token punctuation">)</span>
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>openBrowser<span class="token punctuation">.</span>ts #打开浏览器
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>pluginContainer<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>send<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>sourcemap<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>transformRequest<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>ws<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>ssr
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>__tests__
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>ssrTransform<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>ssrExternal<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>ssrManifestPlugin<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>ssrModuleLoader<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>ssrStacktrace<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>ssrTransform<span class="token punctuation">.</span>ts
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>tsconfig<span class="token punctuation">.</span>json
<span class="token operator">|</span>  <span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span>utils<span class="token punctuation">.</span>ts
<span class="token operator">|</span><span class="token operator">-</span>tsconfig<span class="token punctuation">.</span>base<span class="token punctuation">.</span>json
<span class="token operator">|</span><span class="token operator">-</span>types
<span class="token operator">|</span>  <span class="token operator">|</span><span class="token operator">-</span><span class="token operator">...</span>                  
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="server-核心方法" tabindex="-1"><a class="header-anchor" href="#server-核心方法" aria-hidden="true">#</a> server 核心方法</h4><p>从入口文件 cli.ts，可以看到三个命令对应了 3 个核心的文件&amp;方法；</p><ol><li>dev 命令</li></ol><p>文件路径：./server/index.ts；</p><p>主要方法：createServer；</p><p>主要功能：项目的本地开发命令，基于 httpServer 启动服务，Vite 通过对请求路径的劫持获取资源的内容返回给浏览器，服务端将文件路径进行了重写。例如：</p><p>项目源码如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token operator">/</span>index<span class="token punctuation">.</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>经服务端重写后，node_modules 文件夹下的三方包代码路径也会被拼接完整。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> __vite__cjsImport0_vue from <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span>vite<span class="token operator">/</span>vue<span class="token punctuation">.</span>js<span class="token operator">?</span>v<span class="token operator">=</span>ed69bae0<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">;</span> 
<span class="token keyword">const</span> createApp <span class="token operator">=</span> __vite__cjsImport0_vue<span class="token punctuation">[</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>createApp<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>src<span class="token operator">/</span>pages<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">/</span>index<span class="token punctuation">.</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>2.build 命令 文件路径：./build.ts ；</p><p>主要方法：build；</p><p>主要功能：使用 rollup 打包编译</p><p>3.optimize 命令</p><p>文件路径：./optimizer/index.ts；</p><p>主要方法：optimizeDeps；</p><p>主要功能：主要针对第三方包，Vite 在执行 runOptimize 的时候中会使用 rollup 对三方包重新编译，将编译成符合 esm 模块规范的新的包放入 node_modules 下的 .vite 中，然后配合 resolver 对三方包的导入进行处理：使用编译后的包内容代替原来包的内容，这样就解决了 Vite 中不能使用 cjs 包的问题。</p><p>下面是 .vite 文件夹中的 _metadata.json 文件，它在预编译的过程中生成，罗列了所有被预编译完成的文件及其路径。例如：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>hash<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>31d458ff<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
  <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>browserHash<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>ed69bae0<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
  <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>optimized<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>element<span class="token operator">-</span>plus<span class="token operator">/</span>lib<span class="token operator">/</span>utils<span class="token operator">/</span>dom<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>file<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>node_modules<span class="token operator">/</span><span class="token punctuation">.</span>vite<span class="token operator">/</span>element<span class="token operator">-</span>plus_lib_utils_dom<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>src<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>node_modules<span class="token operator">/</span>element<span class="token operator">-</span>plus<span class="token operator">/</span>lib<span class="token operator">/</span>utils<span class="token operator">/</span>dom<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>needsInterop<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>element<span class="token operator">-</span>plus<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>file<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>node_modules<span class="token operator">/</span><span class="token punctuation">.</span>vite<span class="token operator">/</span>element<span class="token operator">-</span>plus<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>src<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>node_modules<span class="token operator">/</span>element<span class="token operator">-</span>plus<span class="token operator">/</span>lib<span class="token operator">/</span>index<span class="token punctuation">.</span>esm<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>needsInterop<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">false</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>vue<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>file<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>node_modules<span class="token operator">/</span><span class="token punctuation">.</span>vite<span class="token operator">/</span>vue<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>src<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>node_modules<span class="token operator">/</span>vue<span class="token operator">/</span>dist<span class="token operator">/</span>vue<span class="token punctuation">.</span>runtime<span class="token punctuation">.</span>esm<span class="token operator">-</span>bundler<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">,</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>needsInterop<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="模块解析" tabindex="-1"><a class="header-anchor" href="#模块解析" aria-hidden="true">#</a> 模块解析</h4>`,33),y={href:"https://cn.vitejs.dev/guide/dep-pre-bundling.html?fileGuid=DDr3GGh6QRvQgWQC",target:"_blank",rel:"noopener noreferrer"},w={href:"http://esbuild.github.io/?fileGuid=DDr3GGh6QRvQgWQC",target:"_blank",rel:"noopener noreferrer"},_=t(`<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9a3322c3c6c647b0b642eb6dd7c9c1e3~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>为什么 ESbuild 会更快？</p><ol><li>使用 Go 语言</li><li>重度并行，使用 CPU</li><li>高效使用内存</li><li>Scratch 编写，减少使用三方库，避免导致性能不可控</li></ol><p>重写导入为合法的 URL，例如 <code>/node_modules/.vite/my-dep.js?v=f3sf2ebd</code> 以便浏览器能够正确导入它们</p><h4 id="热更新" tabindex="-1"><a class="header-anchor" href="#热更新" aria-hidden="true">#</a> 热更新</h4><p>热更新主体流程如下：</p><ol><li>服务端基于 watcher 监听文件改动，根据类型判断更新方式，并编译资源</li><li>客户端通过 WebSocket 监听到一些更新的消息类型</li><li>客户端收到资源信息，根据消息类型执行热更新逻辑</li></ol><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/baaa3b74a60046ca9d0817102b9e60e5~tplv-k3u1fbpfcp-zoom-1.image" alt=""></p><p>下面是服务端热更新的核心 hmr.ts 中的部分判断逻辑；</p><p>如果配置文件或者环境文件发生修改时，会触发服务重启，才能让配置生效。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>file <span class="token operator">===</span> config<span class="token punctuation">.</span>configFile <span class="token operator">||</span> file<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">.</span>env<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// auto restart server 配置&amp;amp;环境文件修改则自动重启服务</span>
  <span class="token function">debugHmr</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[config change] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>chalk<span class="token punctuation">.</span><span class="token function">dim</span><span class="token punctuation">(</span>shortFile<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
  config<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>
    chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>config or <span class="token punctuation">.</span>env file changed<span class="token punctuation">,</span> restarting server<span class="token operator">...</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">clear</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">restartServer</span><span class="token punctuation">(</span>server<span class="token punctuation">)</span>
  <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>html 文件更新时，将会触发页面的重新加载。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">endsWith</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">.</span>html<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// html 文件更新</span>
  config<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">page reload </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token operator">+</span>         chalk<span class="token punctuation">.</span><span class="token function">dim</span><span class="token punctuation">(</span>shortFile<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    clear<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    timestamp<span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>full<span class="token operator">-</span>reload<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> config<span class="token punctuation">.</span>server<span class="token punctuation">.</span>middlewareMode
    <span class="token operator">?</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">*</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>
    <span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span> <span class="token function">normalizePath</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>root<span class="token punctuation">,</span> file<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// loaded but not in the module graph, probably not js</span>
  <span class="token function">debugHmr</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[no modules matched] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>chalk<span class="token punctuation">.</span><span class="token function">dim</span><span class="token punctuation">(</span>shortFile<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vue 等文件更新时，都会进入 <code>updateModules</code> 方法，正常情况下只会触发 update，实现热更新，热替换；</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">updateModules</span><span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">file</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  modules<span class="token operator">:</span> ModuleNode<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  timestamp<span class="token operator">:</span> number<span class="token punctuation">,</span>
  <span class="token punctuation">{</span> config<span class="token punctuation">,</span> ws <span class="token punctuation">}</span><span class="token operator">:</span> ViteDevServer</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token literal-property property">updates</span><span class="token operator">:</span> Update<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> invalidatedModules <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token operator">&amp;</span>lt<span class="token punctuation">;</span>ModuleNode<span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">// 遍历插件数组，关联下面的片段</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> mod <span class="token keyword">of</span> modules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> boundaries <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token operator">&amp;</span>lt<span class="token punctuation">;</span><span class="token punctuation">{</span>
      boundary<span class="token operator">:</span> ModuleNode
      acceptedVia<span class="token operator">:</span> ModuleNode
    <span class="token punctuation">}</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 设置时间戳</span>
    <span class="token function">invalidate</span><span class="token punctuation">(</span>mod<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> invalidatedModules<span class="token punctuation">)</span>
    <span class="token comment">// 查找引用模块，判断是否需要重载页面</span>
    <span class="token keyword">const</span> hasDeadEnd <span class="token operator">=</span> <span class="token function">propagateUpdate</span><span class="token punctuation">(</span>mod<span class="token punctuation">,</span> timestamp<span class="token punctuation">,</span> boundaries<span class="token punctuation">)</span>
    <span class="token comment">// 找不到引用者则会发起刷新</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>hasDeadEnd<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">page reload </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> chalk<span class="token punctuation">.</span><span class="token function">dim</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        clear<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        timestamp<span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>full<span class="token operator">-</span>reload<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
    updates<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>
      <span class="token operator">...</span><span class="token punctuation">[</span><span class="token operator">...</span>boundaries<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> boundary<span class="token punctuation">,</span> acceptedVia <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
        type<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>boundary<span class="token punctuation">.</span>type<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">-update</span><span class="token template-punctuation string">\`</span></span> <span class="token keyword">as</span> Update<span class="token punctuation">[</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>type<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        timestamp<span class="token punctuation">,</span>
        path<span class="token operator">:</span> boundary<span class="token punctuation">.</span>url<span class="token punctuation">,</span>
        acceptedPath<span class="token operator">:</span> acceptedVia<span class="token punctuation">.</span>url
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 日志输出</span>
  config<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span>
    updates
      <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span> path <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> chalk<span class="token punctuation">.</span><span class="token function">green</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">hmr update </span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span> <span class="token operator">+</span> chalk<span class="token punctuation">.</span><span class="token function">dim</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>\\n<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">clear</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
  <span class="token punctuation">)</span>
  <span class="token comment">// 向客户端发送消息，进行热更新操作</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    type<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>update<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
    updates
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>上面代码中的 modules 是热更新时需要执行的各个插件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> plugin <span class="token keyword">of</span> config<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>plugin<span class="token punctuation">.</span>handleHotUpdate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> filteredModules <span class="token operator">=</span> <span class="token keyword">await</span> plugin<span class="token punctuation">.</span><span class="token function">handleHotUpdate</span><span class="token punctuation">(</span>hmrContext<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>filteredModules<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      hmrContext<span class="token punctuation">.</span>modules <span class="token operator">=</span> filteredModules
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vite 会把模块的依赖关系组合成 moduleGraph，它的结构类似树形，热更新中判断哪些文件需要更新也会依赖 moduleGraph；它的文件内容大致如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// moduleGraph 返回的 ModuleNode 大致结构</span>
 ModuleNode <span class="token punctuation">{</span>
  id<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>src<span class="token operator">/</span>pages<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  file<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>src<span class="token operator">/</span>pages<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  importers<span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  importedModules<span class="token operator">:</span> Set <span class="token punctuation">{</span>
    ModuleNode <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>node_modules<span class="token operator">/</span><span class="token punctuation">.</span>vite<span class="token operator">/</span>vue<span class="token punctuation">.</span>js<span class="token operator">?</span>v<span class="token operator">=</span>32cfd30c<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      file<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>node_modules<span class="token operator">/</span><span class="token punctuation">.</span>vite<span class="token operator">/</span>vue<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token operator">...</span>
      lastHMRTimestamp<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span>vite<span class="token operator">/</span>vue<span class="token punctuation">.</span>js<span class="token operator">?</span>v<span class="token operator">=</span>32cfd30c<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>js<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ModuleNode <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>src<span class="token operator">/</span>pages<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">/</span>index<span class="token punctuation">.</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      file<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>src<span class="token operator">/</span>pages<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">/</span>index<span class="token punctuation">.</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      <span class="token operator">...</span><span class="token operator">...</span>
      url<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>src<span class="token operator">/</span>pages<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">/</span>index<span class="token punctuation">.</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>js<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    ModuleNode <span class="token punctuation">{</span>
      id<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>node_modules<span class="token operator">/</span>element<span class="token operator">-</span>plus<span class="token operator">/</span>lib<span class="token operator">/</span>theme<span class="token operator">-</span>chalk<span class="token operator">/</span>index<span class="token punctuation">.</span>css<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      file<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>Users<span class="token operator">/</span>zcy<span class="token operator">/</span>Documents<span class="token operator">/</span>workspace<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">-</span>front<span class="token operator">/</span>node_modules<span class="token operator">/</span>element<span class="token operator">-</span>plus<span class="token operator">/</span>lib<span class="token operator">/</span>theme<span class="token operator">-</span>chalk<span class="token operator">/</span>index<span class="token punctuation">.</span>css<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      importers<span class="token operator">:</span> <span class="token punctuation">[</span>Set<span class="token punctuation">]</span><span class="token punctuation">,</span>
      importedModules<span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      acceptedHmrDeps<span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      isSelfAccepting<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      transformResult<span class="token operator">:</span> <span class="token punctuation">[</span>Object<span class="token punctuation">]</span><span class="token punctuation">,</span>
      ssrTransformResult<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      ssrModule<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
      lastHMRTimestamp<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      url<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>element<span class="token operator">-</span>plus<span class="token operator">/</span>lib<span class="token operator">/</span>theme<span class="token operator">-</span>chalk<span class="token operator">/</span>index<span class="token punctuation">.</span>css<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
      type<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>js<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token operator">...</span><span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  acceptedHmrDeps<span class="token operator">:</span> Set <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  isSelfAccepting<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  transformResult<span class="token operator">:</span> <span class="token punctuation">{</span>
    code<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token keyword">import</span> __vite__cjsImport0_vue from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span>vite<span class="token operator">/</span>vue<span class="token punctuation">.</span>js<span class="token operator">?</span>v<span class="token operator">=</span>32cfd30c<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">;</span> <span class="token keyword">const</span> createApp <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>__vite__cjsImport0_vue<span class="token punctuation">[</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>createApp<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>\\nimport App from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>src<span class="token operator">/</span>pages<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">/</span>index<span class="token punctuation">.</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>\\nimport <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>element<span class="token operator">-</span>plus<span class="token operator">/</span>lib<span class="token operator">/</span>theme<span class="token operator">-</span>chalk<span class="token operator">/</span>index<span class="token punctuation">.</span>css<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>\\n\\nconst app <span class="token operator">=</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n\\nimport <span class="token punctuation">{</span> addHistoryMethod <span class="token punctuation">}</span> from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>src<span class="token operator">/</span>pages<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">/</span>api<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>\\nimport <span class="token punctuation">{</span>\\n  ElButton<span class="token punctuation">,</span>\\n  ElDropdown<span class="token punctuation">,</span>\\n  <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>ElDropdownMenu<span class="token punctuation">,</span>\\n  ElDropdownItem<span class="token punctuation">,</span>\\n  ElMenu<span class="token punctuation">,</span>\\n  ElSubmenu<span class="token punctuation">,</span>\\n  ElMenuItem<span class="token punctuation">,</span>\\n  <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>ElMenuItemGroup<span class="token punctuation">,</span>\\n  ElPopover<span class="token punctuation">,</span>\\n  ElDialog<span class="token punctuation">,</span>\\n  ElRow<span class="token punctuation">,</span>\\n  ElInput<span class="token punctuation">,</span>\\n  <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>ElLoading<span class="token punctuation">,</span>\\n<span class="token punctuation">}</span> from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span>vite<span class="token operator">/</span>element<span class="token operator">-</span>plus<span class="token punctuation">.</span>js<span class="token operator">?</span>v<span class="token operator">=</span>32cfd30c<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>\\n\\n<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElButton<span class="token punctuation">)</span><span class="token punctuation">;</span>\\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElLoading<span class="token punctuation">)</span><span class="token punctuation">;</span>\\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElDropdown<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElDropdownMenu<span class="token punctuation">)</span><span class="token punctuation">;</span>\\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElDropdownItem<span class="token punctuation">)</span><span class="token punctuation">;</span>\\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElMenu<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElSubmenu<span class="token punctuation">)</span><span class="token punctuation">;</span>\\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElMenuItem<span class="token punctuation">)</span><span class="token punctuation">;</span>\\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElMenuItemGroup<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElPopover<span class="token punctuation">)</span><span class="token punctuation">;</span>\\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElDialog<span class="token punctuation">)</span><span class="token punctuation">;</span>\\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElRow<span class="token punctuation">)</span><span class="token punctuation">;</span>\\napp<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElInput<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>\\nconst f <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token punctuation">{</span>\\n  <span class="token keyword">return</span> app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>#app<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\n<span class="token punctuation">}</span><span class="token punctuation">;</span>\\n\\nconst $backsky <span class="token operator">=</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>back<span class="token operator">-</span>sky<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\<span class="token function">nif</span><span class="token punctuation">(</span><span class="token parameter">$backsky</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\\n  $backsky<span class="token punctuation">.</span>innerHTML <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>\\n  $backsky<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>\\n  window<span class="token punctuation">.</span>onload <span class="token operator">=</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\\n    document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>back<span class="token operator">-</span>sky<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>back<span class="token operator">-</span>sky<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n  <span class="token punctuation">}</span><span class="token punctuation">;</span>\\n<span class="token punctuation">}</span>\\n\\n<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>window<span class="token punctuation">.</span>addHistoryListener <span class="token operator">=</span> <span class="token function">addHistoryMethod</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>historychange<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\n<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>history<span class="token punctuation">.</span>pushState <span class="token operator">=</span>  <span class="token function">addHistoryMethod</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>pushState<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\nhistory<span class="token punctuation">.</span>replaceState <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">=</span>  <span class="token function">addHistoryMethod</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>replaceState<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\n\\n<span class="token comment">// 监听hash路由变化，不与onhashchange互相覆盖\\n&amp;quot; +</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token function">addHashChange</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span><span class="token punctuation">{</span>\\n  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> <span class="token punctuation">{</span>\\n    <span class="token keyword">const</span> $backsky <span class="token operator">=</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>back<span class="token operator">-</span>sky<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\n    <span class="token keyword">if</span><span class="token punctuation">(</span>$backsky <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>$backsky<span class="token punctuation">.</span>innerHTML <span class="token operator">===</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\\n      $backsky<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>$el<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n    <span class="token punctuation">}</span>\\n <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\n\\nfunction <span class="token function">addHashChange</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\\n  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>onhashchange<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>window <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//浏览器不支持\\n    return false;\\n  }\\n  &amp;#39; +</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>addEventListener<span class="token punctuation">)</span> <span class="token punctuation">{</span>\\n    <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>hashchange<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\\n      callback <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n    <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\n  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>attachEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//IE 8 及更早 IE &amp;#39; +</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>版本浏览器\\n    window<span class="token punctuation">.</span><span class="token function">attachEvent</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>onhashchange<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>\\n      callback <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> <span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\n  <span class="token punctuation">}</span>\\n  <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>window<span class="token punctuation">.</span><span class="token function">addHistoryListener</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>history<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span>\\n    callback <span class="token operator">&amp;</span>amp<span class="token punctuation">;</span><span class="token operator">&amp;</span>amp<span class="token punctuation">;</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> <span class="token operator">+</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token function">callback</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>\\n  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>\\n<span class="token punctuation">}</span>\\n\\n\\n<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
    map<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    etag<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token constant">W</span><span class="token operator">/</span><span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token number">846</span><span class="token operator">-</span>Qa424gJKl3YCqHDWXXsM1mFHRqg<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  ssrTransformResult<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  ssrModule<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  lastHMRTimestamp<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  url<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">/</span>src<span class="token operator">/</span>pages<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">/</span>index<span class="token punctuation">.</span>js<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>js<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="原有项目切换" tabindex="-1"><a class="header-anchor" href="#原有项目切换" aria-hidden="true">#</a> 原有项目切换</h3><p>最后我们来看下如何使用 Vite 去打包一个旧的 Vue 项目；</p><p>首先我们需要升级 Vue3</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> vue@next
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>并为项目添加 vite 配置文件，在根目录下创建 vite.config.js，并为它添加一些基础的配置。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// vite.config.js</span>
<span class="token comment">// vite2.1.5</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>path<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> vue from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>@vitejs<span class="token operator">/</span>plugin<span class="token operator">-</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token comment">// 配置选项</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    alias<span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>@utils<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token operator">/</span>src<span class="token operator">/</span>utils<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>引用的第三方组件库可能也会需要升级，例如：升 element-ui 至 element-plus</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> element-plus
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Vue3 在 import 时，需使用 <code>createApp</code> 方法进行初始化</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> createApp <span class="token punctuation">}</span> from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token operator">/</span>index<span class="token punctuation">.</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span>
  ElInput<span class="token punctuation">,</span>
  ElLoading<span class="token punctuation">,</span>
<span class="token punctuation">}</span> from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span>element<span class="token operator">-</span>plus<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElButton<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>ElLoading<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">...</span><span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>到这里就可以将项目运行起来了。 注意：Vite 官方不允许省略 .vue 后缀，否则就会报错；</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">[</span>plugin<span class="token operator">:</span>vite<span class="token operator">:</span><span class="token keyword">import</span><span class="token operator">-</span>analysis<span class="token punctuation">]</span> Failed to resolve <span class="token keyword">import</span> <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token operator">/</span>todoList<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span> from <span class="token operator">&amp;</span>quot<span class="token punctuation">;</span>src<span class="token operator">/</span>pages<span class="token operator">/</span>back<span class="token operator">-</span>sky<span class="token operator">/</span>components<span class="token operator">/</span>header<span class="token operator">/</span>index<span class="token punctuation">.</span>vue<span class="token operator">&amp;</span>quot<span class="token punctuation">;</span><span class="token punctuation">.</span> Does the file exist<span class="token operator">?</span>
<span class="token operator">/</span>components<span class="token operator">/</span>header<span class="token operator">/</span>index<span class="token punctuation">.</span>vue<span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span><span class="token number">23</span>
<span class="token number">1</span>  <span class="token operator">|</span>  
<span class="token number">2</span>  <span class="token operator">|</span>  <span class="token keyword">import</span> todoList from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token operator">/</span>todoList<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> todoList from <span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token operator">/</span>todoList<span class="token punctuation">.</span>vue<span class="token operator">&amp;</span>#<span class="token number">39</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最后我们来对比一下该项目两种构建方式时间的对比；</p><p>Webpack 冷启动，耗时 7513ms：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>⚠ ｢wdm｣: Hash: 1ad1dd54289cfad8ecbe
Version: webpack <span class="token number">4.46</span>.0
Time: 7513ms
Built at: <span class="token number">2021</span>-05-24 <span class="token number">13</span>:59:35
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>相同项目 Vite 冷启动，耗时 924ms：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> vite
Pre-bundling dependencies:
  vue
  element-plus
  @zcy/zcy-request
  element-plus/lib/utils/dom
<span class="token punctuation">(</span>this will be run only when your dependencies or config have changed<span class="token punctuation">)</span>
  vite v2.3.3 dev server running at:
  <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Local: http://localhost:3000/
  <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Network: use <span class="token variable"><span class="token variable">\`</span><span class="token parameter variable">--host</span><span class="token variable">\`</span></span> to expose
  ready <span class="token keyword">in</span> 924ms.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>二次启动（预编译的依赖已存在），耗时 407ms；</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> vite
  vite v2.3.3 dev server running at:
  <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Local: http://localhost:3000/
  <span class="token operator">&amp;</span>gt<span class="token punctuation">;</span> Network: use <span class="token variable"><span class="token variable">\`</span><span class="token parameter variable">--host</span><span class="token variable">\`</span></span> to expose
  ready <span class="token keyword">in</span> 407ms.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h3><p>使用 Vite 进行本地服务启动和热更新都会有明显的提效，至于编译打包环节的差异点有哪些？效果如何？你们还踩过哪些坑？留言告诉我吧。</p><p>推荐阅读：</p>`,41),q={href:"https://dev.to/iggredible/what-the-heck-are-cjs-amd-umd-and-esm-ikm?fileGuid=DDr3GGh6QRvQgWQC",target:"_blank",rel:"noopener noreferrer"},j=n("h2",{id:"推荐阅读",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#推荐阅读","aria-hidden":"true"},"#"),s(" 推荐阅读")],-1),x={href:"https://juejin.cn/post/6974184935804534815",target:"_blank",rel:"noopener noreferrer"},E={href:"https://juejin.cn/post/6976798974757830687",target:"_blank",rel:"noopener noreferrer"},M=n("h2",{id:"开源作品",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#开源作品","aria-hidden":"true"},"#"),s(" 开源作品")],-1),D=n("ul",null,[n("li",null,"政采云前端小报")],-1),z={href:"https://www.zoo.team/openweekly/",target:"_blank",rel:"noopener noreferrer"},S=n("h2",{id:"招贤纳士",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#招贤纳士","aria-hidden":"true"},"#"),s(" 招贤纳士")],-1),V=n("p",null,"政采云前端团队（ZooTeam），一个年轻富有激情和创造力的前端团队，隶属于政采云产品研发部，Base 在风景如画的杭州。团队现有 40 余个前端小伙伴，平均年龄 27 岁，近 3 成是全栈工程师，妥妥的青年风暴团。成员构成既有来自于阿里、网易的“老”兵，也有浙大、中科大、杭电等校的应届新人。团队在日常的业务对接之外，还在物料体系、工程平台、搭建平台、性能体验、云端应用、数据分析及可视化等方向进行技术探索和实战，推动并落地了一系列的内部技术产品，持续探索前端技术体系的新边界。",-1),G=n("p",null,[s("如果你想改变一直被事折腾，希望开始能折腾事；如果你想改变一直被告诫需要多些想法，却无从破局；如果你想改变你有能力去做成那个结果，却不需要你；如果你想改变你想做成的事需要一个团队去支撑，但没你带人的位置；如果你想改变既定的节奏，将会是“5 年工作时间 3 年工作经验”；如果你想改变本来悟性不错，但总是有那一层窗户纸的模糊… 如果你相信相信的力量，相信平凡人能成就非凡事，相信能遇到更好的自己。如果你希望参与到随着业务腾飞的过程，亲手推动一个有着深入的业务理解、完善的技术体系、技术创造价值、影响力外溢的前端团队的成长历程，我觉得我们该聊聊。任何时间，等着你写点什么，发给 "),n("code",null,"ZooTeam@cai-inc.com")],-1),I=n("p",null,[n("img",{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98d3aa3d1f8646a8bcda8cfd9e335a4b~tplv-k3u1fbpfcp-zoom-1.image",alt:""})],-1);function C(H,U){const a=l("ExternalLinkIcon");return e(),c("div",null,[n("p",null,[s("本文已参与好文召集令活动，点击查看："),n("a",u,[s("后端、大前端双赛道投稿，2万元奖池等你挑战！"),p(a)]),i]),n("p",null,[s("> 这是第 105 篇不掺水的原创，想获取更多原创好文，请搜索公众号关注我们吧~ 本文首发于政采云前端博客："),n("a",k,[s("Vite 特性和部分源码解析"),p(a)])]),d,m,n("p",null,[s("Vite 的主要特性就是 Bundleless。基于浏览器开始原生的支持 "),n("a",v,[s("JavaScript 模块功能"),p(a)]),s("，JavaScript 模块依赖于 "),b,s(" 和 "),h,s(" 的特性，目前主流浏览器基本都支持；")]),n("p",null,[s("想要查看具体支持的版本可以"),n("a",f,[s("点击这里"),p(a)]),s("；")]),g,n("p",null,[n("a",y,[s("预构建"),p(a)]),s("是用来提升页面重载速度，它将 CommonJS、UMD 等转换为 ESM 格式。预构建这一步由 "),n("a",w,[s("esbuild"),p(a)]),s(" 执行，这使得 Vite 的冷启动时间比任何基于 JavaScript 的打包程序都要快得多。")]),_,n("p",null,[n("a",q,[s("What are CJS, AMD, UMD, and ESM in Javascript?"),p(a)])]),j,n("p",null,[n("a",x,[s("我在工作中是如何使用 git 的"),p(a)])]),n("p",null,[n("a",E,[s("15 分钟学会 Immutable"),p(a)])]),M,D,n("p",null,[n("strong",null,[s("开源地址 "),n("a",z,[s("www.zoo.team/openweekly/"),p(a)])]),s(" (小报官网首页有微信交流群)")]),S,V,G,I])}const A=o(r,[["render",C],["__file","Vite 特性和部分源码解析.html.vue"]]);export{A as default};
